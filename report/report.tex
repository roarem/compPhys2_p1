\documentclass[12pt]{article}

\usepackage{listings}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{bm}
\usepackage{xcolor}
\usepackage[margin=3cm]{geometry}
\usepackage{graphicx}
\lstdefinestyle{c++}{
basicstyle=\scriptsize\ttfamily,
frame=single,
language=C,
keywordstyle=\bfseries\color{green!40!black},
}
\begin{document}

  \section{Introduction}
  Since it has been shown that Bose-Einstein condensation occur in gases of alkali 
  atoms confined in magnetic traps, understanding the confined Bose systems has 
  become a popular field. In this project we have tried to calculate the ground 
  state energy of various number of trapped bosons using Variational Monte Carlo 
  calculations with a specific trial wavefunction. Firstly using the spherical 
  harmonic oscillator as a trap with no interaction between the particles, then
  swtiching to an elliptical trap. Where in both cases we calculate both the 
  analytical and numerical solution. Also running the calculations with and 
  without a repulsive potential due to the fact that bosons have a size.

  \section{Method}
  \subsection{System}
  A two-body Hamiltonian of this system is on the form
  \begin{equation}
     H = \sum_i^N \left(\frac{-\hbar^2}{2m}\nabla^2_i + V_{ext}(\bm{r}_i)\right) + %
     \sum_{i< j}^N V_{int}(\bm{r}_i,\bm{r}_j)
  \end{equation}
  where the external potential for the trap is for the spherical and elliptical part
  given by
  \begin{equation}
    V_{ext}(\bm{r}) = \left\{%
      \begin{array}{lr}
	\frac{1}{2}m\omega^2r^2 & \text{Spherical}\\
	\frac{1}{2}m[\omega^2(x^2 + y^2) + \gamma^2z^2] & \text{Elliptical}
      \end{array}
      \right.
  \end{equation}
  where $\omega$ is the trap potential strength, and in the elliptical trap $\gamma$ is
  the strength in z-direction.
  The internal potential which represents the repulsion when two boson gets close is
  \begin{equation}
    V_{int}(|\bm{r}_i - \bm{r}_j|) = \left\{%
    \begin{array}{lr}
      \infty & |\bm{r}_i - \bm{r}_j| \leq a\\
      0 & |\bm{r}_i - \bm{r}_j| > a
    \end{array}
    \right.
  \end{equation}
  with $a$ as the hard-core diamater of the bosons.
  Setting up the system with a trial wavefunction $\Psi_T$ for the ground state of the form
  \begin{equation}
    \Psi_T({\bf R})=\Psi_T({\bf r}_1, {\bf r}_2, \dots {\bf r}_N,\alpha,\beta)=\prod_i%
    g(\alpha,\beta,{\bf r}_i)\prod_{i<j}f(a,|{\bf r}_i-{\bf r}_j|),
  \end{equation}
  using $\alpha$ and $\beta$ as variational parameters, and 
  \[ g(\alpha, \beta, \bm{r}_i) = e^{-\alpha(x_i^2 + y_i^2 + \beta z_i^2)} \]
  and
  \begin{equation}
    f(a,|{\bf r}_i-{\bf r}_j|)=\Bigg\{
    \begin{array}{ll}
      0 & {|{\bf r}_i-{\bf r}_j|} \leq {a}\\
	(1-\frac{a}{|{\bf r}_i-{\bf r}_j|}) & {|{\bf r}_i-{\bf r}_j|} > {a}.
    \end{array}
  \end{equation}  
  %
  For the simplest cases where we set the boson size $a = 0$ and $\beta = 1$ the 
  trial wavefunction becomes 
  \begin{equation}
    \Psi_T(\bm{R}) = e^{-\alpha r^2}
    \label{eq:psi1}
  \end{equation}
  Calculating the double derivative of the wavefunction returns
  \begin{equation}
    \nabla^2\Psi_T = \nabla^2 e^{-\alpha r^2} = \nabla -\alpha 2r e^{-\alpha r^2}%
    = 2\alpha e^{-\alpha r^2}(2\alpha r^2-1)
  \end{equation}
  then inserting this result into the expression for the local energy yields
  \begin{equation}
    E_L(\bm{R}) = \frac{1}{\Psi_T(\bm{R})}H\Psi_T(\bm{R}) = 2\alpha(2\alpha r^2-1)
  \end{equation}
  %
  which is the analytical experssion for the local energy in a spherical trap 
  without interaction.
  \subsubsection{Interacting local energy}
  \begin{flalign*}
    \nabla_k^2\Psi_T({\bf R})&=%
    \nabla_k^2\phi_k\prod_{i\neq k}\phi_i \exp \left(\sum_{i<j}\right)\\
    &+\nabla_k\phi_k\prod_{i\neq k}\phi_i\sum_{i\neq k}%
    \nabla_k u_{ij}\exp\left(\sum_{i<j}u_ij\right)\\
    &+ \nabla_k\phi_k\prod_{i\neq k}\phi_i\exp \left(\sum_{i<j}\right)%
    \sum_{i\neq k}\nabla_k u_{ij} \\
    &+ \prod_i\phi_i\sum_{i<j}u_{ij}%
    \exp \left(\sum_{i<j}u_{ij}\right)\sum_{j\neq k}\nabla_k u_{ij}\\
    &+\prod_i\phi_i\exp \left(\sum_{i<j}u_{ij}\right)\sum_{j\neq k}\nabla^2_k u_{ij}
  \end{flalign*}
  dividing by the wavefunction gives us
  \begin{flalign*}
    \frac{1}{\Psi_T({\bf R})}\nabla_k^2\Psi_T({\bf R}) &= \frac{\nabla^2_k\phi_k}{\phi_k} %
    +2\frac{\nabla_k\phi_k}{\phi_k}\sum_{j\neq k}\nabla_k u_{ij} %
    +\sum_{i\le j}u_{ij}\sum_{j\neq k}\nabla_k u_{ij}%
    + \sum_{j\neq k}\nabla^2_k u_{ij}\\
  \end{flalign*}
  \subsection{Numerical method}
  \subsubsection{Brute force Metropolis}
  For the first part we use a Variational Monte Carlo program with a brute force Metropolis
  sampling to calculate the ground state energy. The Metropolis algorithm compares the 
  probability of being in the old position $A_{j\rightarrow i}$ against the probability
  of being in a position in a chosen direction $A_{i\rightarrow j}$.
  \begin{equation}
    \frac{A_{j\rightarrow i}}{A_{i\rightarrow j}} = %
    \frac{p_i T_{i\rightarrow j}}{p_j T_{j\rightarrow i}}
  \end{equation}
  where $T$ is the transition probability and $p$ is the probability distribution.
  Given that the transition probability is independent of direction we are left with the
  \begin{equation}
    \frac{A_{j\rightarrow i}}{A_{i\rightarrow j}} = %
    \frac{p_i}{p_j}
  \end{equation}
  The Metropolis choice is to maximize the $A$ values so preferring
  \begin{equation}
    A_{j\rightarrow i} = \text{min}\left(1,\frac{p_i}{p_j}\right)
  \end{equation}
  This is done by first placing the system in a random, Gaussian distributed position 
  around 0 with a $\sigma = 1/\sqrt{2}$. Evaluating the wavefunction according to 
  equation \ref{eq:psi1}. Then choosing a random particle and dimension, and moving 
  it with a Gaussian distribution to a new position. Do the same evaluation for the 
  new position and comparing
  \[\frac{|\Psi_{New}|^2}{|\Psi_{Old}|^2}\]
  Then by taking a random, uniformly distributed number between 0 and 1 and compare it
  to the ratio between the new and old wavefunction. If the ratio is larger we accept
  the new step, if not we revert back to the old position. Then lastly we sample the energy for
  the resulting system.
  \lstinputlisting[caption=Brute force Metropolis, style=c++]{codes/bruteForceMetro.cpp}
  When using this method we get the result which is shown in table \ref{tab:ha1}. This result is
  in exact correspondence to the analytical solution.
  \subsubsection{Importance sampling}
  To make the choice of sampling more relevant we use importance sampling.
  Here there is a biased direction in the new step which is dependent on the trial wavefunction.
  The new position is given as the solutions to Langevin equation,
  \begin{equation}
    y = x + DF(x)\Delta t + \xi\sqrt{\Delta t}
  \end{equation}
  Here $x$ is the old position, $\Delta t$ the step unit, $D$ is the diffusion coefficient, 
  $F(x)$ quantum force and $\xi$ is a normal distributed random variable.
  The quantum force is given by 
  \begin{equation}
    {\bf F}= 2\frac{1}{\Psi_T}\nabla\Psi_T
  \end{equation}
  which gives the walker an incentive to go towards areas where the wavefunction is large.
  The new comparison is now
  \begin{equation}
    \frac{G(x,y,\Delta t)|\Psi_T(y)|^2}{G(y,x,\Delta t)|\Psi_T(x)|^2}
  \end{equation}
  where 
  \[ G(y,x,\Delta t) = \frac{1}{(4\pi D\Delta t)^{3N/2}}e^{-(y-x-D\Delta tF(x))^2/4D\Delta t}\]
  \subsubsection{Interacting}

  \newpage
  
  \section{Results}
 
  \subsubsection{Brute force Metropolis}
  \input{tables/hastings_ana1dim.tex}
  With the brute force Metropolis method and analytical calculation of the Laplacian the
  results are exactly right, as seen in table for 1 dimension, $10^5$ cycles and step length
  of 1.7. This gives an accpetance rate of about 50\%. With lower step length the acceptance
  rate would go up, but then the energies would be sampled at a more narrow range and we could not
  be sure if it is the acutal ground state.
  In table \ref{tab:ha2} and \ref{tab:ha3} the runs have been done with the same parameters but with
  2 and 3 dimensions. The result is the same with only a slight increase in time for the highest
  number of particles.
  \newpage
  \input{tables/hastings_num1dim.tex}
  Using numerical derivation to find the Laplacian slows the speed of the program by about 200 times
  for 500 particles. The precision is the same as with the analytical calculation and so is the 
  acceptance rate. This tells us that using the numerical calculation is a bad choice when the 
  analytical solution is available for the brute force Metropolis. The same results continuos when
  increasing to 2 and 3 dimensions, as shown in \ref{tab:hn2} and \ref{tab:hn3}.
  
  \subsubsection{Importance sampling}
  \input{tables/imp_ana1dim.tex}
  Given the difference in how the step length is implemented in the two different methods it is
  hard to make any direct comparison of them. The energy and variance have the same values as is
  to be expected and the time difference is negligeble in the range we have tested here.
  \newpage
  \input{tables/imp_num1dim.tex}
  The results for the Metropolis importance sampling algorithm has shown to be much the same as for
  the brute force method, with the obvious difference in acceptance ratio which is not comparable.
  Also here the CPU-time is almost identical.

  \newpage

  \subsubsection{Time comparison}
  \begin{figure}[h!]
    \centerline{
    \includegraphics[scale=0.49]{graphs/Npart_time.pdf}
  }
    \caption{The x-axis is number of particles and y-axis are number of particles per time/step %
	     unit. The lower the graph goes, the more time per particle the program spends. %
	     This shows that the numerical Laplacians loses effectiveness as the number of %
	     particles grows, as for the analytical solutions the methods seem to converge %
	     toward a top.%
	     }
    
  \end{figure}
  For the analytical solutions the time spent on other operations than calculating the energies
  is high for lower number of particles, and as we try more particles the time spent on calculating
  the laplacian dominates and the graph seem to converge to a number around 1000 particles per unit
  step. With the numerical calculation of the Laplacian the effectiveness of the computation
  decreases steeply.



  \appendix
  \input{appendix.tex}
\end{document}
